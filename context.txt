QSO Predictor - Developer Context & Logic Documentation
Version: 1.2 (Optimized & Tactical) Date: December 1, 2025 Developer: Peter Hirst (WU2C)

1. Project Overview
QSO Predictor is a real-time tactical assistant for Amateur Radio digital modes (FT8/FT4). It acts as a "middle-man" between WSJT-X and other tools, using data analytics to predict which stations you can actually contact and recommending the cleanest frequency to transmit on to maximize success rates.

2. Core Architecture & Files
main.py (The GUI & Engine)

Role: Entry point. Manages the Main Window, Table, and event loops.

Key Tech: Uses a custom QAbstractTableModel ("High-Performance Engine") instead of QTableWidget. This allows rendering 200+ rows instantly by managing data in a Python list rather than creating widgets for every cell.

Features:

Throttling: Processes incoming UDP packets in batches (max 50/tick) to prevent UI freezing.

Sorting: Full column sorting enabled.

Pinning: Automatically keeps the "Target" station at the top of the list.

State: Saves window geometry to qso_predictor.ini.

Features: Added "Force Refresh" (F5) menu option.

analyzer.py (The Brain)

Role: Calculates "Probability," "Competition," and "Remote QRM."

Logic:

Synchronous: All lookups are instant (in-memory).

Smart Fetching:

Fetches Band Activity (Who hears who).

Fetches Reverse Beacons (Who hears ME).

Smart Backoff: If API fails, retries in 15s -> 5m -> 15m -> 1h -> 24h.

Jitter: Adds random delay (10-60s) to the 2-minute poll to avoid "Soft Bans" from PSK Reporter.

Status Handling: Updates the UI header ("Fetching...", "Monitoring", "Retrying").

band_map_widget.py (The Visualization)

Role: Draws the spectral heatmap at the bottom of the window.

Visual Style:

Green/Yellow/Red Bars: Local Signals (Height = SNR).

Blue Bars (Foreground): Remote QRM (Signals heard by the DX, not you).

Lines: Yellow Dotted (Current TX), Green Dashed (Rec. Gap), Magenta (Target).

Red Background: Visualizes "Occupied/Blocked" frequencies during calculation.

Logic:

History: Tracks signals for 28 seconds (approx. two FT8 cycles).

Recommendation: Scans for the Widest Gap in the band, avoiding local signals (+/- 90Hz) and remote QRM.

udp_handler.py (The Ears)

Role: Listens on port 2237 for WSJT-X Status and Decode packets.

Robustness: Uses a custom manual packet parser that safely skips variable-length fields to correctly extract the Tx Frequency (Tx DF) even if the packet format varies slightly or contains unexpected nulls.

psk_client.py

Role: Fetches XML data from PSK Reporter.

Queries: Now performs two distinct queries:

get_band_reports: General traffic (10 min history).

get_reports_for_call: Reverse beacon check for "My Call" (15 min history).

3. The Probability Algorithm (Rational Justification)
The following section details the "Tactical Logic" used to calculate the 0-99% probability score.

The 4 Pillars of the Algorithm

1. The Baseline: Signal Asymmetry (SNR)

Logic:

SNR > +10: 85% (Booming)

SNR > -10: 60% (Solid)

SNR < -15: 25-45% (Marginal)

Real-World Justification: Amateur radio propagation is rarely perfectly reciprocal. Just because you hear a station at -10 dB doesn't mean they hear you at -10 dB.

The "Local Noise" Factor: Most DX stations are in quiet locations. You might be in a noisy city. You hearing them at -20 is a miracle; them hearing you at -20 is routine.

The "Power" Factor: If they are running 1000W and you are running 50W, a strong inbound signal does not guarantee they can hear your reply.

Verdict: Starting with a conservative baseline (rather than 100% for strong signals) accounts for this inherent asymmetry.

2. The "Open Door": Reverse Beacon & Proximity

Logic:

If the Target spotted me: 100% (Instant Lock).

If someone in the Target's Grid (4-char) spotted me: +25%.

If someone in the Target's Region (2-char) spotted me: +15%.

Real-World Justification: This is the strongest part of your algorithm. Propagation (especially on HF) works like a flashlight beam, not a laser. It illuminates a geographic region.

If you are decoding VK3XYZ in Melbourne, and VK3ABC (also in Melbourne) just spotted you, the ionosphere is wide open between your location and Melbourne.

The fact that VK3XYZ hasn't spotted you yet is likely just timing. The path is open; the probability of a QSO is extremely high.

3. The "Freshness" Heuristic (Behavioral Analysis)

Logic:

Scenario A: Station has Zero Spots on PSK Reporter.

If SNR is Strong (> -5 dB): +10% Bonus.

If SNR is Weak (< -12 dB): -15% Penalty.

Real-World Justification: This distinguishes between a "New Opening" and a "Deaf Station."

The "Fresh CQ": A station appears out of nowhere at +5 dB. They have no spots because they just turned their radio on. This is the Golden Moment. They have no pileup yet. You want to jump on this immediately. The algorithm correctly boosts this.

The "Deaf Alligator": A station is calling CQ at -18 dB for 10 minutes and hearing nobody. The algorithm correctly penalizes this; they likely have high local noise or a bad antenna.

4. The Pileup Penalty (Statistics)

Logic:

> 40 spots: -30%

> 20 spots: -20%

> 10 spots: -10%

Real-World Justification: This is pure statistics. Even if you have a +10 dB path to a rare DX station, if 50 other people are calling them simultaneously, your probability of being the one selected drops largely due to Receiver Blocking and slot congestion.

If 50 people call, the decoder might only successfully decode 3 or 4 of them due to overlap.

Even if decoded, the operator might pick a different callsign.

Verdict: This penalty prevents "False Hope" on rare DXpeditions where the signal is loud but the queue is impossible.

4. Work Log (Latest Session)
Performance Overhaul: Switched Table Widget to QAbstractTableModel + Batch Processing. Removed threading from the analyzer to fix UI freezes.

UDP Parsing Fix: Rewrote udp_handler to correctly skip variable fields and reliably extract Tx DF (fixing the "0Hz Current Frequency" bug).

Visual Overhaul:

Removed falling waterfall logic.

Moved Blue QRM bars to the foreground (on top of green bars).

Added Yellow Dotted line for Current TX.

Added detailed Legend.

Reverse Beacon Integration: Added logic to fetch "Who Hears Me" and applied Proximity Bonuses (Same Grid, Same Region) to the probability score.

Smart API Handling: Added Jitter (random delays) and Exponential Backoff to avoid PSK Reporter bans. Added F5 / "File -> Refresh Spots".

5. Potential Future Features
"Focus Mode" Filtering:

Add checkboxes toolbar: [ ] Hide Weak, [ ] Hide Low Prob, [ ] CQ Only.

Essential for busy bands to reduce visual noise.

Smart Alerts / Watchlist:

Allow user to define "Wanted" calls (P5*, VP8*).

Play sound/flash window on match.

Azimuth & Distance:

Calculate bearing to target grid for antenna pointing.

Logbook Integration (ADIF):

Load user's wsjtx_log.adi.

Gray out already worked stations (B4).

Highlight "New Ones" (ATNO).